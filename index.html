<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindscribe - Simply Learn It</title>
    <!-- Space Grotesk Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="icon" type="image/x-icon" href="https://aditya-cmd-max.github.io/mindscribe/logo1.png">
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --accent-purple: #a855f7;
            --accent-pink: #ec4899;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-orange: #f97316;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --card-radius: 16px;
            --element-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
            --glass-bg: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --sidebar-width: 320px;
        }

        .light-theme {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #334155;
            --text-muted: #64748b;
            --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Space Grotesk', sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            transition: var(--transition);
            overflow: hidden;
            height: 100vh;
            line-height: 1.6;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: radial-gradient(circle at 0% 0%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 100% 0%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 100% 100%, rgba(236, 72, 153, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 0% 100%, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
        }

        /* Header Styles */
        .app-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
            z-index: 10;
            position: relative;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 12px;
            color: white;
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
            transition: var(--transition);
        }

        .logo:hover {
            transform: rotate(10deg) scale(1.05);
        }

        .app-name {
            font-size: 1.75rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary), var(--accent-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .slogan {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: -5px;
            font-weight: 400;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border-radius: var(--element-radius);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: var(--transition);
            font-size: 0.95rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            box-shadow: 0 4px 6px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 10px 15px rgba(99, 102, 241, 0.4);
        }

        .btn-icon {
            padding: 0.6rem;
            border-radius: 50%;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transition: var(--transition);
        }

        .btn-icon:hover {
            background: var(--accent-primary);
            color: white;
            transform: scale(1.1);
        }

        /* Main Content Layout */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-right: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: var(--transition);
            z-index: 5;
        }

        .sidebar-header {
            padding: 1.25rem;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .new-note-btn {
            width: 100%;
            justify-content: center;
            padding: 0.85rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .search-container {
            padding: 0 1.25rem 1.25rem;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 0.85rem 1rem 0.85rem 3rem;
            border-radius: var(--element-radius);
            border: none;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: var(--transition);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .search-input:focus {
            outline: 2px solid var(--accent-primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .notes-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.75rem;
        }

        .notes-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .section-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .notes-count {
            font-size: 0.85rem;
            padding: 0.3rem 0.7rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 20px;
            color: white;
            font-weight: 600;
        }

        .note-item {
            padding: 1.25rem;
            border-radius: var(--card-radius);
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

        .note-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 0;
            background: linear-gradient(to bottom, var(--accent-primary), var(--accent-secondary));
            transition: var(--transition);
        }

        .note-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .note-item:hover::before {
            height: 100%;
        }

        .note-item.selected {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
            border-left: 4px solid var(--accent-primary);
            box-shadow: var(--shadow);
        }

        .note-item.selected::before {
            height: 100%;
        }

        .note-title {
            font-weight: 700;
            margin-bottom: 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 1.05rem;
        }

        .note-preview {
            font-size: 0.9rem;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }

        .note-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .note-tags {
            display: flex;
            gap: 0.35rem;
            flex-wrap: wrap;
        }

        .tag {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            padding: 0.25rem 0.6rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .tag-remove {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 0;
            font-size: 0.7rem;
        }

        /* Editor Styles */
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: transparent;
            position: relative;
        }

        .editor-header {
            padding: 1.25rem 2rem;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .editor-title {
            font-size: 1.75rem;
            font-weight: 800;
            background: transparent;
            border: none;
            color: var(--text-primary);
            width: 100%;
            padding: 0.5rem 0;
            letter-spacing: -0.5px;
        }

        .editor-title:focus {
            outline: none;
        }

        .editor-actions {
            display: flex;
            gap: 0.75rem;
        }

        .editor-tags {
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            max-height: 120px;
            overflow-y: auto;
        }

        .tag-editor {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: none;
            border-radius: var(--element-radius);
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            transition: var(--transition);
            min-width: 120px;
        }

        .tag-editor:focus {
            outline: 2px solid var(--accent-primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
        }

        .editor-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background: transparent;
        }

        .note-editor {
            width: 100%;
            height: 100%;
            background: transparent;
            border: none;
            color: var(--text-primary);
            resize: none;
            font-size: 1.05rem;
            line-height: 1.7;
            font-family: 'Inter', sans-serif;
        }

        .note-editor:focus {
            outline: none;
        }

        /* AI Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 1rem;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--card-radius);
            width: 100%;
            max-width: 650px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: var(--shadow);
            transform: translateY(20px) scale(0.95);
            transition: var(--transition);
            border: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0) scale(1);
        }

        .modal-header {
            padding: 1.75rem 2rem;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary), var(--accent-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modal-body {
            padding: 2rem;
            overflow-y: auto;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .upload-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2.5rem;
            border: 2px dashed var(--glass-border);
            border-radius: var(--card-radius);
            margin-bottom: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            background: var(--bg-tertiary);
        }

        .upload-area:hover {
            border-color: var(--accent-primary);
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .prompts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 2rem 0;
        }

        .prompt-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
            padding: 1.5rem 1rem;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: var(--card-radius);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .prompt-btn:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
            border-color: var(--accent-primary);
        }

        .prompt-btn:nth-child(1) {
            color: var(--accent-blue);
        }
        .prompt-btn:nth-child(2) {
            color: var(--accent-green);
        }
        .prompt-btn:nth-child(3) {
            color: var(--accent-orange);
        }
        .prompt-btn:nth-child(4) {
            color: var(--accent-pink);
        }
        .prompt-btn:nth-child(5) {
            color: var(--accent-purple);
        }

        .prompt-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .custom-prompt {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        .custom-prompt input {
            flex: 1;
            padding: 1rem;
            border-radius: var(--element-radius);
            border: none;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 1rem;
        }

        .custom-prompt input:focus {
            outline: 2px solid var(--accent-primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
        }

        .modal-footer {
            padding: 1.5rem 2rem;
            border-top: 1px solid var(--glass-border);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            background: var(--glass-bg);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
            box-shadow: 0 4px 6px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 10px 15px rgba(239, 68, 68, 0.4);
        }

        /* Image Preview */
        #image-preview-container {
            position: relative;
            margin: 1.5rem 0;
            display: none;
            border-radius: var(--card-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        #image-preview {
            width: 100%;
            max-height: 250px;
            object-fit: cover;
        }

        #remove-image-btn {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: var(--danger);
            color: white;
        }

        /* AI Response Area */
        #ai-response-area {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: var(--card-radius);
            margin: 1.5rem 0;
            min-height: 120px;
            border: 1px solid var(--glass-border);
            max-height: 200px;
            overflow-y: auto;
        }

        /* Loader */
        .loader {
            border: 3px solid var(--bg-tertiary);
            border-top: 3px solid var(--accent-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Footer */
        .app-footer {
            padding: 1rem 2rem;
            text-align: center;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: var(--text-muted);
            z-index: 5;
        }

        .footer-heart {
            color: var(--accent-pink);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                width: 300px;
            }
            
            .editor-header, .editor-tags {
                padding: 1rem 1.5rem;
            }
            
            .editor-content {
                padding: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                bottom: 0;
                z-index: 20;
                width: 85%;
                max-width: 320px;
                border-radius: 0;
                border-right: 1px solid var(--glass-border);
            }

            .sidebar.active {
                left: 0;
            }

            .overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 15;
                opacity: 0;
                pointer-events: none;
                transition: var(--transition);
                backdrop-filter: blur(5px);
            }

            .overlay.active {
                opacity: 1;
                pointer-events: all;
            }

            .menu-toggle {
                display: block !important;
            }

            .app-header {
                padding: 1rem;
            }
            
            .editor-header {
                padding: 1rem;
            }

            .editor-content {
                padding: 1rem;
            }

            .editor-title {
                font-size: 1.5rem;
            }
            
            .editor-tags {
                padding: 1rem;
            }

            .prompts-grid {
                grid-template-columns: 1fr;
            }

            .btn-text {
                display: none;
            }
            
            .app-footer {
                flex-direction: column;
                gap: 0.5rem;
                padding: 1rem;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none;
        }

        .flex {
            display: flex;
        }

        .menu-toggle {
            display: none;
        }
      
        .ai-logo {
            height: 28px;
            width: 28px;
            margin-right: 10px;
            vertical-align: middle;
            border-radius: 6px;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--accent-secondary), var(--accent-purple));
        }
        
        /* Animation classes */
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Tutorial Overlay */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .tutorial-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .tutorial-content {
            background: var(--bg-secondary);
            border-radius: var(--card-radius);
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow);
            position: relative;
        }

        .tutorial-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
        }

        .tutorial-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
        }

        .tutorial-dots {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .tutorial-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-muted);
            transition: var(--transition);
        }

        .tutorial-dot.active {
            background: var(--accent-primary);
            transform: scale(1.2);
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: var(--element-radius);
            box-shadow: var(--shadow);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body class="dark-theme">
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo-container">
                <button class="btn btn-icon menu-toggle">
                    <i data-lucide="menu"></i>
                </button>
                <div class="logo">
                    <img src="https://aditya-cmd-max.github.io/mindscribe/logo.png" alt="Mindscribe Logo" style="width: 100%; height: 100%; object-fit: contain;">
                </div>
                <div>
                    <h1 class="app-name">Mindscribe</h1>
                    <div class="slogan">Simply learn it</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-icon" id="theme-toggle">
                    <i data-lucide="moon"></i>
                </button>
                <button class="btn btn-icon" id="tutorial-btn">
                    <i data-lucide="help-circle"></i>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <button class="btn btn-primary new-note-btn" id="sidebar-new-note-btn">
                        <i data-lucide="plus"></i>
                        <span>New Note</span>
                    </button>
                </div>
                <div class="search-container">
                    <div class="search-box">
                        <i data-lucide="search" class="search-icon"></i>
                        <input type="text" class="search-input" placeholder="Search notes..." id="search-notes">
                    </div>
                </div>
                <div class="notes-list">
                    <div class="notes-list-header">
                        <h2 class="section-title">Your Notes</h2>
                        <span class="notes-count" id="notes-count">0</span>
                    </div>
                    <div id="notes-list">
                        <!-- Notes will be populated here -->
                    </div>
                </div>
            </aside>

            <!-- Editor -->
            <div class="editor-container">
                <div class="editor-header">
                    <input type="text" class="editor-title" id="note-title" placeholder="Untitled Note">
                    <div class="editor-actions">
                        <button class="btn btn-icon" id="ai-modal-btn">
                            <i data-lucide="sparkles"></i>
                        </button>
                        <button class="btn btn-icon" id="delete-note-btn">
                            <i data-lucide="trash-2"></i>
                        </button>
                    </div>
                </div>
                <div class="editor-tags">
                    <div id="tags-container">
                        <!-- Tags will be populated here -->
                    </div>
                    <input type="text" class="tag-editor" id="new-tag-input" placeholder="Add tag...">
                </div>
                <div class="editor-content">
                    <textarea class="note-editor" id="note-editor" placeholder="Start writing your note here..."></textarea>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="app-footer">
            <div>Â© 2025 Mindscribe. All rights reserved.Powered by Exonova</div>
            <div>Made with <span class="footer-heart">â™¥</span> by Aditya Jha</div>
        </footer>
    </div>

    <!-- Overlay for mobile sidebar -->
    <div class="overlay"></div>

    <!-- AI Modal -->
    <div class="modal-overlay" id="ai-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <img src="https://aditya-cmd-max.github.io/exonovaai/logo1.png" alt="AI Logo" class="ai-logo">
                    El Futuro
                </h2>
                <button class="btn btn-icon" id="close-ai-modal">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <div class="modal-body">
                <p style="color: var(--text-muted); margin-bottom: 1.5rem;">Choose a task, upload an image, or ask a custom question.</p>
                
                <!-- Image Upload -->
                <label for="image-upload" class="upload-area">
                    <i data-lucide="upload-cloud" style="width: 2.5rem; height: 2.5rem; margin-bottom: 0.75rem; color: var(--accent-blue);"></i>
                    <span>Click to upload an image</span>
                </label>
                <input id="image-upload" type="file" accept="image/*" class="hidden">
                
                <div id="image-preview-container">
                    <img id="image-preview" src="#" alt="Image preview">
                    <button id="remove-image-btn" class="btn btn-icon">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                
                <!-- Pre-defined Prompts -->
                <div class="prompts-grid">
                    <button class="prompt-btn" data-prompt-type="summarize_note">
                        <i data-lucide="file-text" style="width: 24px; height: 24px;"></i>
                        Summarize Note
                    </button>
                    <button class="prompt-btn" data-prompt-type="action_items">
                        <i data-lucide="list-checks" style="width: 24px; height: 24px;"></i>
                        Action Items
                    </button>
                    <button class="prompt-btn" data-prompt-type="continue_writing">
                        <i data-lucide="edit-3" style="width: 24px; height: 24px;"></i>
                        Continue Writing
                    </button>
                    <button class="prompt-btn" data-prompt-type="brainstorm">
                        <i data-lucide="lightbulb" style="width: 24px; height: 24px;"></i>
                        Brainstorm Ideas
                    </button>
                    <button class="prompt-btn" id="analyze-image-btn" data-prompt-type="analyze_image" disabled>
                        <i data-lucide="image" style="width: 24px; height: 24px;"></i>
                        Analyze Image
                    </button>
                </div>
                
                <!-- AI Response -->
                <div id="ai-response-area">
                    <p id="ai-response-text">Your AI response will appear here...</p>
                    <div id="ai-loading" class="hidden">
                        <div class="loader"></div>
                    </div>
                </div>
                
                <!-- Custom Prompt -->
                <div class="custom-prompt">
                    <input type="text" id="ai-prompt-input" placeholder="Ask a custom question...">
                    <button class="btn btn-primary" id="send-ai-btn">
                        <i data-lucide="send"></i>
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancel-ai">Cancel</button>
                <button class="btn btn-primary" id="apply-ai-suggestion">Apply Suggestion</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="delete-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Delete Note ðŸ˜¢</h2>
                <button class="btn btn-icon" id="close-delete-modal">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this note? This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancel-delete">Cancel</button>
                <button class="btn btn-danger" id="confirm-delete">Delete</button>
            </div>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div class="tutorial-overlay" id="tutorial-modal">
        <div class="tutorial-content">
            <button class="tutorial-close" id="close-tutorial">
                <i data-lucide="x"></i>
            </button>
            <h2 style="margin-bottom: 1rem;">Welcome to Mindscribe!</h2>
            <div id="tutorial-slide-1">
                <p>Mindscribe helps you take notes and enhance them with AI. Here's how to get started:</p>
                <ul style="margin: 1rem 0 1rem 1.5rem;">
                    <li>Create new notes with the button in the sidebar</li>
                    <li>Add tags to organize your notes</li>
                    <li>Use the AI assistant to enhance your content</li>
                    <li>Search through all your notes easily</li>
                </ul>
            </div>
            <div class="tutorial-navigation">
                <button class="btn" id="tutorial-next">Next</button>
            </div>
            <div class="tutorial-dots">
                <div class="tutorial-dot active"></div>
                <div class="tutorial-dot"></div>
                <div class="tutorial-dot"></div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i data-lucide="info" id="notification-icon"></i>
        <span id="notification-text"></span>
    </div>

    <script>
        // Initialize Lucide Icons
        lucide.createIcons();
        
        // State Management
        let notes = [];
        let currentNoteId = null;
        let uploadedImageBase64 = null;
        let tutorialSlide = 1;
        
        // DOM Elements
        const themeToggleBtn = document.getElementById('theme-toggle');
        const menuToggleBtn = document.querySelector('.menu-toggle');
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.querySelector('.overlay');
        const newNoteBtn = document.getElementById('sidebar-new-note-btn');
        const deleteNoteBtn = document.getElementById('delete-note-btn');
        const noteTitleEl = document.getElementById('note-title');
        const noteEditorEl = document.getElementById('note-editor');
        const tagsContainerEl = document.getElementById('tags-container');
        const newTagInput = document.getElementById('new-tag-input');
        const searchInput = document.getElementById('search-notes');
        const notesListEl = document.getElementById('notes-list');
        const notesCountEl = document.getElementById('notes-count');
        const aiModalBtn = document.getElementById('ai-modal-btn');
        const aiModal = document.getElementById('ai-modal');
        const closeAiModalBtn = document.getElementById('close-ai-modal');
        const aiPromptInput = document.getElementById('ai-prompt-input');
        const sendAiBtn = document.getElementById('send-ai-btn');
        const aiResponseText = document.getElementById('ai-response-text');
        const aiLoadingIndicator = document.getElementById('ai-loading');
        const aiPromptBtns = document.querySelectorAll('.prompt-btn');
        const analyzeImageBtn = document.getElementById('analyze-image-btn');
        const imageUploadInput = document.getElementById('image-upload');
        const imagePreview = document.getElementById('image-preview');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const removeImageBtn = document.getElementById('remove-image-btn');
        const deleteModal = document.getElementById('delete-modal');
        const confirmDeleteBtn = document.getElementById('confirm-delete');
        const cancelDeleteBtn = document.getElementById('cancel-delete');
        const applyAiSuggestionBtn = document.getElementById('apply-ai-suggestion');
        const cancelAiBtn = document.getElementById('cancel-ai');
        const tutorialBtn = document.getElementById('tutorial-btn');
        const tutorialModal = document.getElementById('tutorial-modal');
        const closeTutorialBtn = document.getElementById('close-tutorial');
        const tutorialNextBtn = document.getElementById('tutorial-next');
        const notification = document.getElementById('notification');
        const notificationIcon = document.getElementById('notification-icon');
        const notificationText = document.getElementById('notification-text');
        
        // API Key - Using your Gemini API key
        const GEMINI_API_KEY = "AIzaSyB99Bow78KTvGN3GZkn0hs3-RMonLweLv0";
        
        // Show notification
        function showNotification(message, type = 'info') {
            notificationText.textContent = message;
            
            // Set icon based on type
            let iconName = 'info';
            if (type === 'success') iconName = 'check-circle';
            if (type === 'error') iconName = 'alert-circle';
            
            notificationIcon.setAttribute('data-lucide', iconName);
            lucide.createIcons();
            
            notification.classList.add('show');
            
            // Auto hide after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Theme Toggle
        themeToggleBtn.addEventListener('click', () => {
            document.body.classList.toggle('dark-theme');
            document.body.classList.toggle('light-theme');
            
            const icon = themeToggleBtn.querySelector('i');
            const currentIcon = icon.getAttribute('data-lucide');
            icon.setAttribute('data-lucide', currentIcon === 'moon' ? 'sun' : 'moon');
            lucide.createIcons();
            
            showNotification(`Switched to ${document.body.classList.contains('dark-theme') ? 'dark' : 'light'} mode`);
        });
        
        // Mobile Menu Toggle
        menuToggleBtn.addEventListener('click', () => {
            sidebar.classList.add('active');
            overlay.classList.add('active');
        });
        
        overlay.addEventListener('click', () => {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
        });
        
        // Tutorial
        tutorialBtn.addEventListener('click', () => {
            tutorialModal.classList.add('active');
        });
        
        closeTutorialBtn.addEventListener('click', () => {
            tutorialModal.classList.remove('active');
        });
        
        tutorialNextBtn.addEventListener('click', () => {
            tutorialSlide++;
            if (tutorialSlide > 3) {
                tutorialModal.classList.remove('active');
                tutorialSlide = 1;
            } else {
                // Update tutorial content based on slide
                const dots = document.querySelectorAll('.tutorial-dot');
                dots.forEach((dot, index) => {
                    if (index === tutorialSlide - 1) {
                        dot.classList.add('active');
                    } else {
                        dot.classList.remove('active');
                    }
                });
                
                // Update tutorial content
                const tutorialSlideEl = document.getElementById('tutorial-slide-1');
                if (tutorialSlide === 2) {
                    tutorialSlideEl.innerHTML = `
                        <h3 style="margin-bottom: 1rem;">Using AI Features</h3>
                        <p>The AI assistant can help you with:</p>
                        <ul style="margin: 1rem 0 1rem 1.5rem;">
                            <li>Summarizing your notes</li>
                            <li>Extracting action items</li>
                            <li>Continuing your writing</li>
                            <li>Brainstorming ideas</li>
                            <li>Analyzing images</li>
                        </ul>
                        <p>Just click the sparkles icon to get started!</p>
                    `;
                    tutorialNextBtn.textContent = 'Next';
                } else if (tutorialSlide === 3) {
                    tutorialSlideEl.innerHTML = `
                        <h3 style="margin-bottom: 1rem;">Tips & Tricks</h3>
                        <ul style="margin: 1rem 0 1rem 1.5rem;">
                            <li>Use tags to organize your notes by topic</li>
                            <li>Search helps you find notes quickly</li>
                            <li>Switch between light and dark mode</li>
                            <li>Your notes are saved automatically</li>
                            <li>You can upload images for AI analysis</li>
                        </ul>
                        <p>Enjoy using Mindscribe!</p>
                    `;
                    tutorialNextBtn.textContent = 'Get Started';
                }
            }
        });
        
        // Load notes from localStorage
        function loadNotes() {
            try {
                const storedNotes = localStorage.getItem('mindscribeNotes');
                notes = storedNotes ? JSON.parse(storedNotes) : [];
                
                // Create welcome note if no notes exist
                if (notes.length === 0) {
                    const welcomeNote = {
                        id: Date.now().toString(),
                        title: 'Welcome to Mindscribe!',
                        content: 'This is your first note. You can edit this text, add tags, and use the AI assistant to enhance your notes.\n\nClick the sparkles icon to see what the AI can do for you!',
                        tags: ['Welcome', 'Getting Started'],
                        updatedAt: Date.now()
                    };
                    notes.push(welcomeNote);
                    saveNotes();
                    
                    // Show tutorial on first use
                    setTimeout(() => {
                        tutorialModal.classList.add('active');
                    }, 1000);
                }
            } catch (error) {
                console.error("Failed to load notes from local storage:", error);
                notes = [];
            }
            
            renderNotesList(notes);
            updateNotesCount();
            
            // Select the first note by default
            if (notes.length > 0) {
                selectNote(notes[0].id);
            }
        }
        
        // Save notes to localStorage
        function saveNotes() {
            try {
                localStorage.setItem('mindscribeNotes', JSON.stringify(notes));
            } catch (error) {
                console.error("Failed to save notes to local storage:", error);
            }
        }
        
        // Render notes list
        function renderNotesList(notesToRender) {
            notesListEl.innerHTML = '';
            
            // Sort notes by updatedAt (newest first)
            notesToRender.sort((a, b) => (b.updatedAt || 0) - (a.updatedAt || 0));
            
            notesToRender.forEach(note => {
                const noteEl = document.createElement('div');
                noteEl.className = 'note-item fade-in';
                noteEl.dataset.id = note.id;
                
                noteEl.innerHTML = `
                    <div class="note-title">${note.title || 'Untitled'}</div>
                    <div class="note-preview">${note.content ? note.content.substring(0, 60) + (note.content.length > 60 ? '...' : '') : '...'}</div>
                    <div class="note-meta">
                        <div class="note-tags">
                            ${note.tags && note.tags.length > 0 ? 
                                note.tags.slice(0, 2).map(tag => `<span class="tag">${tag}</span>`).join('') : 
                                ''}
                            ${note.tags && note.tags.length > 2 ? `<span class="tag">+${note.tags.length - 2}</span>` : ''}
                        </div>
                        <div class="note-date">${formatDate(note.updatedAt)}</div>
                    </div>
                `;
                
                noteEl.addEventListener('click', () => {
                    selectNote(note.id);
                    // Close sidebar on mobile after selection
                    if (window.innerWidth <= 768) {
                        sidebar.classList.remove('active');
                        overlay.classList.remove('active');
                    }
                });
                
                notesListEl.appendChild(noteEl);
            });
            
            // Highlight selected note
            if (currentNoteId) {
                const selectedNote = document.querySelector(`.note-item[data-id="${currentNoteId}"]`);
                if (selectedNote) {
                    selectedNote.classList.add('selected');
                }
            }
        }
        
        // Update notes count
        function updateNotesCount() {
            notesCountEl.textContent = notes.length;
        }
        
        // Select a note
        function selectNote(noteId) {
            currentNoteId = noteId;
            const note = notes.find(n => n.id === noteId);
            
            if (note) {
                noteTitleEl.value = note.title || '';
                noteEditorEl.value = note.content || '';
                renderTags(note.tags || []);
                
                // Remove selected class from all notes
                document.querySelectorAll('.note-item').forEach(item => {
                    item.classList.remove('selected');
                });
                
                // Add selected class to the clicked note
                const selectedNote = document.querySelector(`.note-item[data-id="${noteId}"]`);
                if (selectedNote) {
                    selectedNote.classList.add('selected');
                }
            }
        }
        
        // Render tags
        function renderTags(tags) {
            tagsContainerEl.innerHTML = '';
            
            if (tags && tags.length > 0) {
                tags.forEach(tag => {
                    const tagEl = document.createElement('span');
                    tagEl.className = 'tag';
                    tagEl.textContent = tag;
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'tag-remove';
                    removeBtn.innerHTML = '<i data-lucide="x" style="width: 12px; height: 12px;"></i>';
                    removeBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        removeTag(tag);
                    });
                    
                    tagEl.appendChild(removeBtn);
                    tagsContainerEl.appendChild(tagEl);
                });
            }
            
            // Re-initialize icons
            lucide.createIcons();
        }
        
        // Remove tag
        function removeTag(tagToRemove) {
            const noteIndex = notes.findIndex(n => n.id === currentNoteId);
            if (noteIndex > -1) {
                notes[noteIndex].tags = notes[noteIndex].tags.filter(tag => tag !== tagToRemove);
                saveNotes();
                renderTags(notes[noteIndex].tags);
                showNotification(`Removed tag: ${tagToRemove}`);
            }
        }
        
        // Format date
        function formatDate(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }
        
        // Save note changes with debounce
        let saveTimeout;
        function saveNoteChanges() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                const noteIndex = notes.findIndex(n => n.id === currentNoteId);
                if (noteIndex > -1) {
                    // Get tags from the tags container
                    const updatedTags = Array.from(tagsContainerEl.querySelectorAll('.tag'))
                        .map(el => el.textContent.replace('Ã—', '').trim());
                    
                    notes[noteIndex].title = noteTitleEl.value;
                    notes[noteIndex].content = noteEditorEl.value;
                    notes[noteIndex].tags = updatedTags;
                    notes[noteIndex].updatedAt = Date.now();
                    
                    saveNotes();
                    renderNotesList(notes);
                }
            }, 500);
        }
        
        // Create new note
        function createNewNote() {
            const newNote = {
                id: Date.now().toString(),
                title: 'New Note',
                content: '',
                tags: [],
                createdAt: Date.now(),
                updatedAt: Date.now()
            };
            
            notes.unshift(newNote);
            saveNotes();
            renderNotesList(notes);
            selectNote(newNote.id);
            
            // Focus on title field
            setTimeout(() => {
                noteTitleEl.focus();
            }, 100);
            
            showNotification('Created a new note');
        }
        
        // Delete current note
        function deleteCurrentNote() {
            if (!currentNoteId) return;
            
            const noteIndex = notes.findIndex(n => n.id === currentNoteId);
            if (noteIndex > -1) {
                const noteTitle = notes[noteIndex].title || 'Untitled';
                notes.splice(noteIndex, 1);
                saveNotes();
                renderNotesList(notes);
                updateNotesCount();
                
                // Select another note if available
                if (notes.length > 0) {
                    selectNote(notes[0].id);
                } else {
                    // Clear editor if no notes left
                    currentNoteId = null;
                    noteTitleEl.value = '';
                    noteEditorEl.value = '';
                    renderTags([]);
                }
                
                showNotification(`Deleted note: ${noteTitle}`);
            }
        }
        
        // Search notes
        function searchNotes(searchTerm) {
            if (!searchTerm) {
                renderNotesList(notes);
                return;
            }
            
            const filteredNotes = notes.filter(note => 
                (note.title && note.title.toLowerCase().includes(searchTerm)) ||
                (note.content && note.content.toLowerCase().includes(searchTerm)) ||
                (note.tags && note.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
            );
            
            renderNotesList(filteredNotes);
        }
        
        // Add new tag
        function addNewTag() {
            if (!currentNoteId) return;
            
            const tagText = newTagInput.value.trim();
            if (tagText) {
                const noteIndex = notes.findIndex(n => n.id === currentNoteId);
                if (noteIndex > -1) {
                    if (!notes[noteIndex].tags) notes[noteIndex].tags = [];
                    
                    if (!notes[noteIndex].tags.includes(tagText)) {
                        notes[noteIndex].tags.push(tagText);
                        saveNotes();
                        renderTags(notes[noteIndex].tags);
                        newTagInput.value = '';
                        showNotification(`Added tag: ${tagText}`);
                    } else {
                        showNotification('Tag already exists', 'error');
                    }
                }
            }
        }
        
        // Call Gemini API - FIXED VERSION
        async function callGeminiAPI(promptType, customPrompt, noteTitle, noteContent, imageData) {
            aiResponseText.textContent = 'Generating response...';
            aiLoadingIndicator.classList.remove('hidden');
            
            // Scroll to response area
            const modalBody = document.querySelector('.modal-body');
            modalBody.scrollTo({ top: modalBody.scrollHeight, behavior: 'smooth' });
            
            let fullPrompt = '';
            
            // Construct the prompt based on the prompt type
            switch (promptType) {
                case 'summarize_note':
                    fullPrompt = `Summarize the following note into exactly 3 clear bullet points. If the user has uploaded any image then summarise that too.

NOTE CONTENT:
"${noteContent || "No content provided"}"

Instructions:
1. Use plain text only (no **, *, ##, or Markdown).
2. Format as 3 bullet points with bullet point(â—).
3. Each point should be short and focused.
4. Do not add extra commentary before or after the summary.
`;
    break;
                case 'action_items':
                    fullPrompt = `Generate a numbered list of action items from the following note.\n\nNOTE CONTENT:\n"${noteContent}"`;
                    break;
                case 'continue_writing':
                    fullPrompt = `Continue writing from the last sentence of this note. Provide a coherent and natural continuation of the text.\n\nNOTE CONTENT:\n"${noteContent}"`;
                    break;
                case 'brainstorm':
                    fullPrompt = `Based on the title "${noteTitle}" and the following note content, provide a short list of 5-7 related ideas or concepts.\n\nNOTE CONTENT:\n"${noteContent}"`;
                    break;
                case 'analyze_image':
                    fullPrompt = `You are Mindscribe AI, helping the user analyze an image. 
Look at the provided image carefully and give a detailed description.

Instructions:
1. Explain what the image contains in plain text.
2. Do NOT use Markdown formatting (no **, *, ##).
3. Use clear sentences. If needed, use bullet points(â—) with dashes (-).
4. Mention colors, objects, text (if visible), and overall theme.
5. Keep it simple and helpful for note-taking.
`;
    break;
                case 'custom':
                default:
                    fullPrompt = `You are Mindscribe AI, an assistant that helps with note-taking. 
The user asked: "${customPrompt}"

Context of the note:
- Title: ${noteTitle || "Untitled"}
- Content: ${noteContent || "Empty note"}

Instructions:
1. DO NOT use Markdown symbols like **, *, or ##.
2. Use plain text only.
3. If you need emphasis, use UPPERCASE words or dashes (-) instead.
4. Keep your answer clear and concise.
`;
    break;
            }
            
            let payload;
            
            // FIXED: Using the correct API structure for Gemini
            if (imageData) {
                payload = {
                    contents: [{
                        parts: [
                            { text: fullPrompt },
                            {
                                inlineData: {
                                    mimeType: "image/jpeg",
                                    data: imageData
                                }
                            }
                        ]
                    }]
                };
            } else {
                payload = {
                    contents: [{
                        parts: [{ text: fullPrompt }]
                    }]
                };
            }
            
            try {
                // FIXED: Using the correct Gemini API endpoint
                const response = await fetch(
  `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_API_KEY}`,
                  {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("API Error:", errorData);
                    throw new Error(`API error: ${response.status} ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.candidates && 
                    result.candidates[0] && 
                    result.candidates[0].content && 
                    result.candidates[0].content.parts && 
                    result.candidates[0].content.parts[0] && 
                    result.candidates[0].content.parts[0].text) {
                    
                    aiResponseText.textContent = result.candidates[0].content.parts[0].text;
                    showNotification('AI response generated successfully', 'success');
                } else {
                    aiResponseText.textContent = "Sorry, I could not generate a response. Please try again.";
                    console.error("Unexpected API response:", result);
                    showNotification('Failed to generate AI response', 'error');
                }
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                aiResponseText.textContent = "An error occurred. Please try again.";
                showNotification('Error connecting to Exonova.', 'error');
            } finally {
                aiLoadingIndicator.classList.add('hidden');
                
                // Scroll to response area
                setTimeout(() => {
                    modalBody.scrollTo({ top: modalBody.scrollHeight, behavior: 'smooth' });
                }, 100);
            }
        }
        
        // Apply AI suggestion to note
        function applyAiSuggestion() {
            if (!currentNoteId || !aiResponseText.textContent) return;
            
            const noteIndex = notes.findIndex(n => n.id === currentNoteId);
            if (noteIndex > -1) {
                notes[noteIndex].content += '\n\n' + aiResponseText.textContent;
                notes[noteIndex].updatedAt = Date.now();
                
                saveNotes();
                noteEditorEl.value = notes[noteIndex].content;
                
                // Close AI modal
                aiModal.classList.remove('active');
                
                showNotification('AI suggestion applied to note');
            }
        }
        
        // Event Listeners
        newNoteBtn.addEventListener('click', createNewNote);
        
        deleteNoteBtn.addEventListener('click', () => {
            if (currentNoteId) {
                deleteModal.classList.add('active');
            }
        });
        
        confirmDeleteBtn.addEventListener('click', () => {
            deleteCurrentNote();
            deleteModal.classList.remove('active');
        });
        
        cancelDeleteBtn.addEventListener('click', () => {
            deleteModal.classList.remove('active');
        });
        
        noteTitleEl.addEventListener('input', saveNoteChanges);
        noteEditorEl.addEventListener('input', saveNoteChanges);
        
        searchInput.addEventListener('input', (e) => {
            searchNotes(e.target.value.toLowerCase());
        });
        
        newTagInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                addNewTag();
            }
        });
        
        // AI Modal
        aiModalBtn.addEventListener('click', () => {
            aiModal.classList.add('active');
        });
        
        closeAiModalBtn.addEventListener('click', () => {
            aiModal.classList.remove('active');
        });
        
        cancelAiBtn.addEventListener('click', () => {
            aiModal.classList.remove('active');
        });
        
        applyAiSuggestionBtn.addEventListener('click', applyAiSuggestion);
        
        // AI Prompt Buttons
        aiPromptBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const promptType = btn.dataset.promptType;
                const note = notes.find(n => n.id === currentNoteId);
                
                if (note) {
                    callGeminiAPI(
                        promptType, 
                        '', 
                        note.title || '', 
                        note.content || '', 
                        promptType === 'analyze_image' ? uploadedImageBase64 : null
                    );
                }
            });
        });
        
        // Send custom AI prompt
        sendAiBtn.addEventListener('click', () => {
            const prompt = aiPromptInput.value.trim();
            if (prompt) {
                const note = notes.find(n => n.id === currentNoteId);
                if (note) {
                    callGeminiAPI('custom', prompt, note.title || '', note.content || '', null);
                    aiPromptInput.value = '';
                }
            } else {
                showNotification('Please enter a question first', 'error');
            }
        });
        
        aiPromptInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                sendAiBtn.click();
            }
        });
        
        // Image Upload
        imageUploadInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedImageBase64 = e.target.result.split(',')[1];
                    imagePreview.src = e.target.result;
                    imagePreviewContainer.style.display = 'block';
                    analyzeImageBtn.disabled = false;
                    showNotification('Image uploaded successfully');
                };
                reader.readAsDataURL(file);
            }
        });
        
        removeImageBtn.addEventListener('click', () => {
            imagePreviewContainer.style.display = 'none';
            imagePreview.src = '';
            uploadedImageBase64 = null;
            analyzeImageBtn.disabled = true;
            imageUploadInput.value = '';
            showNotification('Image removed');
        });
        
        // Initialize the app
        loadNotes();
        
        // Re-initialize icons after all DOM manipulation
        setTimeout(() => {
            lucide.createIcons();
        }, 100);
    </script>
</body>
</html>
